<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1194.0.min.js"></script>
    <script src="https://lex-web-ui.us-east-1.amazonaws.com/v1.js"></script> <!-- Use correct region -->
</head>
<body>
    <h1>Task Management</h1>

    <!-- Chatbot UI for Lex -->
    <div id="chatbot"></div>

    <script>
        // Lex Bot Configuration
        const lexSettings = {
            botName: 'TaskManagerBot',  // Your Lex Bot name
            botAlias: 'TSTALIASID',     // Your Lex Bot Alias
            region: 'us-west-2',        // AWS region
            identityPoolId: 'us-west-2:0177e1c7-4f8b-43b7-b9c9-d5593334ca5a'  // Cognito Identity Pool ID
        };

        // Initialize Lex Web UI
        const lexWebUi = new LexWebUi({
            botName: lexSettings.botName,
            botAlias: lexSettings.botAlias,
            region: lexSettings.region,
            identityPoolId: lexSettings.identityPoolId
        });

        lexWebUi.init();  // Initialize the Lex Web UI

        // Example: Task storage using DynamoDB
        AWS.config.update({
            region: lexSettings.region
        });

        const dynamoDB = new AWS.DynamoDB.DocumentClient();
        
        // Function to add a task to DynamoDB
        function addTaskToDB(taskName) {
            const params = {
                TableName: "Tasks",  // Make sure you create a "Tasks" table in DynamoDB
                Item: {
                    TaskID: Date.now().toString(),
                    TaskName: taskName,
                    Status: 'Pending'
                }
            };

            dynamoDB.put(params, function(err, data) {
                if (err) {
                    console.error("Error adding task: ", err);
                } else {
                    console.log("Task added successfully: ", data);
                }
            });
        }

        // Lex function to handle input from the user (e.g., adding a task)
        function handleLexBotResponse(userInput) {
            const params = {
                botName: lexSettings.botName,
                botAlias: lexSettings.botAlias,
                userId: 'user123',  // Unique user ID
                inputText: userInput
            };

            const lexRuntime = new AWS.LexRuntime();
            lexRuntime.postText(params, function(err, data) {
                if (err) {
                    console.log("Error:", err);
                } else {
                    console.log("Lex Bot response:", data);
                    if (data.dialogState === 'ReadyForFulfillment') {
                        // Add task logic after Lex confirms fulfillment
                        if (data.intentName === 'AddTaskIntent') {
                            const taskName = data.slots.TaskName;
                            addTaskToDB(taskName);  // Add task to DynamoDB
                        }
                    }
                }
            });
        }

        // Example: Send a message to Lex (this could be done via the UI input)
        // For testing purposes, you can trigger this function
        handleLexBotResponse("Add a new task to complete the project");

    </script>
</body>
</html>
